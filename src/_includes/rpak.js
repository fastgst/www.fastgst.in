const RPAK=function(){'use strict';function a(){return Math.floor(Date.now()/1000)}function b(){const e=new Date(),t=String(e.getUTCDate()).padStart(2,'0'),n=String(e.getUTCMonth()+1).padStart(2,'0'),r=e.getUTCFullYear();return`${t}${n}${r}`}function c(e){return String(e).padStart(2,'0')}function d(e){let t='';for(let n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)^42);return t}function e(e){let t='';for(let n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)^42);return t}function f(e){return e.split('').reverse().join('')}function g(e){const t=d(e);if(typeof btoa!=='undefined')return btoa(t);else if(typeof Buffer!=='undefined')return Buffer.from(t).toString('base64');throw new Error('Base64 not supported')}function h(e){let t;if(typeof atob!=='undefined')t=atob(e);else if(typeof Buffer!=='undefined')t=Buffer.from(e,'base64').toString('utf-8');else throw new Error('Base64 not supported');return e=t,e=(n=e,e=e,n)^void 0,e(e);var n}function i(e,t){if(typeof e!=='number'||e<1)throw new Error('Validity must be positive');if(typeof t!=='string'||t.length===0)throw new Error('Payload must be non-empty');const n=a(),r=b(),o=n+parseInt(r,10),u=c(e),p=`${u}${o}`,l=`${p}|${t}`,s=f(l),y=g(s);return`RPAK_${y}`}function j(e){try{if(!e||!e.startsWith('RPAK_'))return{valid:!1,error:'Invalid format: Missing prefix'};const t=e.substring(5);let n=h(t);n=f(n);const r=n.split('|');if(r.length<2)return{valid:!1,error:'Invalid format: Missing |'};const o=r[0],u=r.slice(1).join('|'),p=parseInt(o.substring(0,2),10);if(isNaN(p))return{valid:!1,error:'Invalid format: Cannot parse validity'};const l=parseInt(o.substring(2),10);if(isNaN(l))return{valid:!1,error:'Invalid format: Cannot parse combined'};const s=b(),y=l-parseInt(s,10),v=a(),m=v-y;return{valid:m>=0&&m<=p,validity:p,keyEpoch:y,currentEpoch:v,timeDifference:m,payload:u,expired:m>p,notYetValid:m<0}}catch(t){return{valid:!1,error:`Validation error: ${t.message}`}}}return{generate:i,validate:j}}();typeof module!=='undefined'&&module.exports&&(module.exports=RPAK);
